<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
</head>
<body>
<h2>å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼</h2>

<h3>1.æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨ã€‚</h3>

<pre><code>public class Singleton {
    //å£°æ˜ä¸€ä¸ªç§æœ‰é™æ€å˜é‡
    private static Singleton instance;
    //ç§æœ‰çš„æ„å»ºæ–¹æ³•,æ­¤å¤„ä¸åŒè¯­è¨€,æœ‰ä¸åŒçš„æ–¹å¼.æœ‰çš„æ˜¯é‡å†™æ„å»ºæ–¹æ³•.
    private Singleton(){...}
    
    //æä¾›ç»™å¤–ç•Œè·å–å•ä¾‹å¯¹è±¡çš„é™æ€å‡½æ•°
    public static Singleton getInstance() {
        //1.åˆ¤æ–­é™æ€é‡instanceæ˜¯å¦==null,è‹¥å­˜åœ¨è¿”å›instance,ä¸å­˜åœ¨åˆ›å»ºåè¿”å›.
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
</code></pre>

<blockquote>
<p>ä¼˜ç‚¹: æ‡’åŠ è½½æ–¹å¼æ„å»º,ç®€å•,æ˜“ç”¨..</p>

<p>ç¼ºç‚¹: ä¸æ”¯æŒå¤šçº¿ç¨‹.æ²¡æœ‰äº’æ–¥é”(åŒæ­¥é”),ä¸¥æ ¼æ¥è¯´è¿™ç§æ–¹å¼ä¸ç®—å•ä¾‹æ¨¡å¼.æ›´åƒæ‡’åŠ è½½çš„æ–¹å¼.</p>
</blockquote>

<h3>2,æ‡’æ±‰å¼,çº¿ç¨‹å®‰å…¨</h3>

<pre><code>public class Singleton {
    //å£°æ˜ä¸€ä¸ªç§æœ‰é™æ€å˜é‡
    private static Singleton instance;
    //ç§æœ‰çš„æ„å»ºæ–¹æ³•,æ­¤å¤„ä¸åŒè¯­è¨€,æœ‰ä¸åŒçš„æ–¹å¼.æœ‰çš„æ˜¯é‡å†™æ„å»ºæ–¹æ³•.
    private Singleton(){...}
    
    //æä¾›ç»™å¤–ç•Œè·å–å•ä¾‹å¯¹è±¡çš„é™æ€å‡½æ•°
    public static synchronized Singleton getInstance() {
        //1.åˆ¤æ–­é™æ€é‡instanceæ˜¯å¦==null,è‹¥å­˜åœ¨è¿”å›instance,ä¸å­˜åœ¨åˆ›å»ºåè¿”å›.
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
</code></pre>

<pre><code>//OCä¸­ä¸¤ç§æ–¹å¼,ä¸»è¦æ˜¯åœ¨æ„å»ºå¯¹è±¡è¿‡ç¨‹ä¸­,é‡å†™çš„åˆ†é…å†…å­˜ç©ºé—´çš„æ–¹æ³•,åŠ é”
+(instancetype)allocWithZone:(NSZone *)zone 
{
    //åŠ äº’æ–¥é”è§£å†³å¤šçº¿ç¨‹è®¿é—®å®‰å…¨é—®é¢˜
    @synchronized(self) {
        if (instance == nil) {
            instance = [super allocWithZone:zone];
        }
    }
    return instance;
}
 
+(instancetype)allocWithZone:(NSZone *)zone 
{
    //GCD:ä¸€æ¬¡æ€§å‡½æ•°,æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        instance = [super allocWithZone:zone];
    });
    return instance;
}

+(instancetype)getInstance 
{
    return [[Singleton alloc] init]
}
//ä¸¥æ ¼è€Œè¨€OCè¿˜è¦é‡å†™,copy,mutableCopyæ–¹æ³•
-(id)copyWithZone:(NSZone *)zone
{
    return instance;
}

-(id)mutableCopyWithZone:(NSZone *)zone
{
    return instance;
}
</code></pre>

<blockquote>
<p>è¿™ç§æ–¹å¼:ç±»ä¼¼æ‡’åŠ è½½æ–¹å¼,ä½†èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ä¸­å¾ˆå¥½çš„å·¥ä½œ.</p>

<p>ä¼˜ç‚¹: æ‡’åŠ è½½æ–¹å¼æ„å»º,åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰ä¼šåˆå§‹åŒ–,ä¸ä½¿ç”¨ä¸åˆ›å»º,é¿å…å†…å­˜æµªè´¹.</p>

<p>ç¼ºç‚¹: å¿…é¡»åŠ é”(äº’æ–¥é”/åŒæ­¥é”)æ‰èƒ½ä¿è¯å•ä¾‹,åŠ é”å½±å“æ•ˆç‡.ä¸€èˆ¬æƒ…å†µä¸‹,ä¸éœ€è¦åŒæ­¥.</p>
</blockquote>

<h3>3,é¥¿æ±‰å¼</h3>

<pre><code>//é¥¿æ±‰å¼1,æ™®éä½¿ç”¨è¿™ç§é¥¿æ±‰å¼,ç®€å•æ˜“æ‡‚.
public class Singleton {
    private static Singleton instance = new Singleton();
    private Singleton () {...}
    
    public static Singleton getInstance() {
        return instance;
    }
}

//é¥¿æ±‰å¼2,é™æ€ä»£ç å—æ–¹å¼,é™æ€ä»£ç å—çš„ç‰¹ç‚¹:åªè¢«æ‰§è¡Œä¸€æ¬¡.é¿å…å¤šçº¿ç¨‹,ç¡®ä¿instanceçš„å”¯ä¸€æ€§.
public class Singleton {
    private static Singleton instance = null;
    static{
        instance = new Singleton();
    }
    private Singleton(){...}
    public static Singleton getInstance(){
        return instance;
    }
}
</code></pre>

<pre><code>//OC
+(void)load {
    instance = [Singleton alloc] init];
}

//å½“ç±»è¢«åŠ è½½åˆ°å†…å­˜æ—¶,å°±ä¼šè°ƒç”¨loadæ–¹æ³•,åœ¨loadä¸­æ²¡æœ‰å¿…è¦åŠ é”ï¼Œå› ä¸ºæ­¤å‡½æ•°åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡.
+(id)allocWithZone:(NSZone *)zone {
    if (instance == nil) { // é˜²æ­¢åˆ›å»ºå¤šæ¬¡
        instance = [super allocWithZone:zone];
    }
    return instance;
}
//ä¸¥æ ¼è€Œè¨€é‡å†™copy,mutableCopyæ–¹æ³•
</code></pre>

<blockquote>
<p>é¥¿æ±‰å¼ åŸºäºclassloderæœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜.</p>

<p>ä¼˜ç‚¹: æ— éœ€åŠ é”,æ•ˆç‡é«˜,ç®€å•æ˜“æ‡‚.</p>

<p>ç¼ºç‚¹: ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–äº†å•ä¾‹å¯¹è±¡,è¿‡æ—©å ç”¨å†…å­˜.</p>
</blockquote>

<ul>
<li>ğŸ‘€è¡¥å……1:é™æ€å˜é‡,æ–¹æ³• ä¸ éé™æ€å˜é‡,æ–¹æ³• çš„ åŒºåˆ«??</li>
</ul>

<h3>4,åŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCL)</h3>

<pre><code>public class Singleton {  
    private static Singleton singleton;  
    private Singleton (){...}
      
    public static Singleton getSingleton() {  
        if (singleton == null) {  
            synchronized (Singleton.class) {  
                if (singleton == null) {  
                    singleton = new Singleton();  
                }  
             }  
        }  
        return singleton;  
    }  
} 
</code></pre>

<blockquote>
<p>åŒé”æœºåˆ¶ï¼Œå®‰å…¨ä¸”åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚
é‡‡ç”¨äº†æ‡’åŠ è½½æ–¹å¼.</p>
</blockquote>

<h3>5,é™æ€å†…éƒ¨ç±»å®ç°æ–¹å¼</h3>

<pre><code>//ğŸ‘€è¡¥å……2finalä¿®é¥°ç¬¦
public class Singleton {  
    private static class SingletonHolder {  
        private static final Singleton INSTANCE = new Singleton();  
    }  
    private Singleton (){...}  
    
    public static final Singleton getInstance() {  
        return SingletonHolder.INSTANCE;  
    }  
}   
</code></pre>

<blockquote>
<p>è¿™ç§æ–¹å¼èƒ½è¾¾åˆ°åŒæ£€é”æ–¹å¼ä¸€æ ·çš„åŠŸæ•ˆ(ä¿è¯æ•ˆç‡)ï¼Œä¸”å®ç°æ›´ç®€å•,è€Œä¸”å¯¹é™æ€åŸŸä½¿ç”¨äº†å»¶è¿Ÿåˆå§‹åŒ–.</p>
</blockquote>

<ul>
<li>åŸç†:è¿™ç§æ–¹å¼ä¹Ÿæ˜¯åˆ©ç”¨äº†classloadæœºåˆ¶ä¿è¯åˆå§‹åŒ–instanceæ—¶,åªæœ‰ä¸€ä¸ªçº¿ç¨‹.</li>
<li>ğŸ”¥é™æ€å†…éƒ¨ç±»å®ç°æ–¹å¼ ä¸ é¥¿æ±‰å¼ä¸åŒçš„æ˜¯:

<ul>
<li>é¥¿æ±‰å¼:ç¬¬ä¸€æ¬¡åŠ è½½Singletonæ—¶,instanceå°±ä¼šè¢«å®ä¾‹åŒ–,æ²¡æœ‰æ‡’æ±‰å¼çš„æ‡’åŠ è½½æ•ˆæœ.</li>
<li>é™æ€å†…éƒ¨ç±»æ–¹å¼:ç¬¬ä¸€æ¬¡åŠ è½½Singletonç±»æ—¶,ä¸ä¼šåˆå§‹åŒ–instance,åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getInstance()å‡½æ•°æ—¶,ç§ç”¨SingletonHolderç±»æ‰ä¼šè¢«åŠ è½½,è¿™æ—¶æ‰åˆå§‹åŒ–instance.</li>
<li>ä¼˜ç‚¹:æ—¢èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨,ä¿è¯å•ä¾‹å¯¹è±¡çš„å”¯ä¸€æ€§,åˆèƒ½åšåˆ°å»¶è¿Ÿå•ä¾‹çš„åˆå§‹åŒ–.</li>
<li>è¡¥å……æ‡’æ±‰å¼ç›¸å¯¹é¥¿æ±‰å¼çš„ä¼˜ç‚¹(å¦‚å®ä¾‹åŒ–å•ä¾‹å¯¹è±¡çš„è¿‡ç¨‹å¾ˆè€—è´¹èµ„æº,ä¼šå¯¼è‡´ç¼–è¾‘é˜¶æ®µæ—¶é—´å¢é•¿,æ‡’æ±‰å¼å¯é¿å….)</li>
</ul></li>
</ul>

<h3>6, æšä¸¾</h3>

<blockquote>
<p>å®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜è‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–æœºåˆ¶ï¼Œé˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–.
<code>
public enum SingletonEnum {
    INSTANCE;
    public void doSomething() {
        System.out.println(&quot;do something&quot;);
    }
}
</code></p>
</blockquote>

<h3>7,å®¹å™¨å®ç°å•ä¾‹</h3>

<blockquote>
<p>SingletonManagerå¯ä»¥ç®¡ç†å¤šä¸ªå•ä¾‹ç±»å‹ï¼Œä½¿ç”¨æ—¶æ ¹æ®keyè·å–å¯¹è±¡å¯¹åº”ç±»å‹çš„å¯¹è±¡ã€‚è¿™ç§æ–¹å¼å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„æ¥å£è·å–æ“ä½œï¼Œéšè—äº†å…·ä½“å®ç°ï¼Œé™ä½äº†è€¦åˆåº¦ã€‚</p>
</blockquote>

<pre><code>import java.util.HashMap;
import java.util.Map;
public class SingletonManager {
    private static Map&lt;String, Object&gt; objMap = new HashMap&lt;String, Object&gt;();

    public static void regsiterService(String key, Object instance) {
        if (!objMap.containsKey(key)) {
            objMap.put(key, instance);
        }
    }

    public static Object getService(String key) {
        return objMap.get(key);
    }
}

</code></pre>

<hr />

<hr />

<hr />

<h2>è¡¥å……çŸ¥è¯†ç‚¹</h2>

<h5>è¡¥å……1:</h5>

<ul>
<li>ğŸ‘€è¡¥å……1:é™æ€å˜é‡,æ–¹æ³• ä¸ éé™æ€å˜é‡,æ–¹æ³• çš„ åŒºåˆ«??

<ul>
<li>é™æ€å˜é‡/æ–¹æ³•æ˜¯åœ¨ç±»ä¸­ä½¿ç”¨staitcä¿®é¥°ï¼Œåœ¨ç±»å®šä¹‰çš„æ—¶å€™å·²ç»è¢«è£…è½½å’Œåˆ†é…å†…å­˜ç©ºé—´.</li>
<li>éé™æ€å˜é‡/æ–¹æ³•ä¸ç”¨staticä¿®é¥°,åœ¨ç±»å®šä¹‰æ—¶ä¸ä¼šåˆ†é…å†…å­˜,åªæœ‰åœ¨ç±»è¢«å®ä¾‹åŒ–å¯¹è±¡æ—¶,æ‰ä¼šä¸ºéé™æ€å˜é‡åˆ†é…å†…å­˜. è€Œé™æ€æ–¹æ³•:åªæœ‰åœ¨å¯¹è±¡è°ƒç”¨æ—¶,æ‰ä¼šä¸ºæ­¤åˆ†é…å†…å­˜.</li>
<li>é™æ€æ–¹æ³•ä¸­åªèƒ½è°ƒç”¨é™æ€å˜é‡æˆ–è€…æ–¹æ³•ï¼Œä¸èƒ½è°ƒç”¨éé™æ€æ–¹æ³•æˆ–è€…éé™æ€æˆå‘˜.</li>
<li>éé™æ€æ–¹æ³•æ—¢å¯ä»¥è°ƒç”¨é™æ€å˜é‡/æ–¹æ³•,åˆå¯ä»¥è°ƒç”¨éé™æ€å˜é‡/æ–¹æ³•ã€‚</li>
</ul></li>
</ul>

<h5>è¡¥å……2:</h5>

<pre><code>// finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚
1, finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿,åªèƒ½ç”¨.
2, finalä¸ä»…å¯ä»¥ä¿®é¥°ç±»ï¼Œè¿˜å¯ä»¥ä¿®é¥°å˜é‡ï¼Œè¢«finalä¿®é¥°çš„å˜é‡å°±æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œåªèƒ½èµ‹å€¼ä¸€æ¬¡
</code></pre>

<h5>è¡¥å……3:</h5>

<pre><code>1,å®šä¹‰constå¸¸é‡,å…·æœ‰ä¸å¯å˜æ€§. 2,é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…
//constä¸å®å®šä¹‰åŒºåˆ«?
// å®çš„ç”¨æ³•:1,å®šä¹‰å¸¸ç”¨å­—ç¬¦ä¸² 2, å®šä¹‰ä¸€æ®µä»£ç 
// constçš„ç”¨æ³•: 1,constä»…ç”¨æ¥ä¿®é¥°å³è¾¹çš„å˜é‡ 2,è¢«constä¿®é¥°çš„å˜é‡æ˜¯åªè¯»çš„.
// åŒºåˆ«:
    // 1,ç¼–è¯‘æ—¶åˆ»ä¸åŒ,conståœ¨é¢„ç¼–è¯‘é˜¶æ®µ,conståœ¨ç¼–è¯‘é˜¶æ®µ.
    // 2, å®ä¸ä¼šæ£€æŸ¥ä»£ç é”™è¯¯,åªèƒ½æ›¿æ¢,constä¼šç¼–è¯‘æŠ¥é”™.
    // 3, å®çš„å¥½å¤„:èƒ½å®šä¹‰ä»£ç ,å­—ç¬¦ä¸²,æ–¹æ³•,å‚æ•°,constä¸èƒ½å®šä¹‰ä»£ç ,æ–¹æ³•.å®çš„ç¼ºç‚¹:å¤§é‡ä½¿ç”¨å®,æ˜“å¼•èµ·é¢„ç¼–è¯‘æ—¶é—´è¿‡ä¹…,æ¯æ¬¡ç¼–è¯‘éƒ½éœ€è¦é‡æ–°æ›¿æ¢.
    //eg: int *const p; pä¸ºåªè¯», *pä¸ºå˜é‡.(åŸåˆ™:å€¼ä¿®é¥°å³ä¾§å˜é‡)
//constç”¨é€”:
    // 1.æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢åªèƒ½é€šè¿‡åœ°å€è¯»å–å€¼,ä¸èƒ½é€šè¿‡åœ°å€ä¿®æ”¹å€¼
    // 2.éœ€æ±‚2:æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢ä¸èƒ½ä¿®æ”¹å‚æ•°çš„åœ°å€ã€‚

#include &lt;stdio.h&gt;

int main(int argc, const char * argv[]) {
    int a = 6;
    test1(&amp;a);
    printf(&quot;Hello, World!\n&quot;);
    return 0;
}

int test1(int *const a)
//int test2(int const *a)
{
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    int b = 10;
    a = &amp;b;
    *a = b;
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    return 1;
}


int test1(int *const a)
{
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    int b = 10;
    //ç¼–è¯‘æŠ¥é”™,ä¸èƒ½ä¿®æ”¹açš„åœ°å€,åªèƒ½ä¿®æ”¹aè®¿é—®çš„å€¼.
//    a = &amp;b;
    *a = b;
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    return 1;
}

int test2(int const *a)
{
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    int b = 10;
    a = &amp;b;
    //ç¼–è¯‘æŠ¥é”™,ä¸èƒ½é€šè¿‡åœ°å€ä¿®æ”¹å€¼,åªèƒ½ä¿®æ”¹åœ°å€a,ä¸èƒ½é€šè¿‡aä¿®æ”¹è®¿é—®çš„å†…å­˜ç©ºé—´.
//    *a = b;
    printf(&quot;ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥====%zd\n&quot;, *a);
    return 1;
}
</code></pre>

<h2>ğŸ”¥ åŒé”æœºåˆ¶ ä¸ æ‡’æ±‰å¼ çš„å¯¹æ¯”,ä½ æ›´æ„¿ä½¿ç”¨å“ªç§å®ç°æ–¹å¼?</h2>

<h2>ğŸ”¥ å•ä¾‹æ¨¡å¼å”¯ä¸€å®ä¾‹ä¸ºä»€ä¹ˆå¿…é¡»ä¸ºé™æ€é‡?</h2>

<hr />

<hr />

<hr />

<hr />

</body>
</html>